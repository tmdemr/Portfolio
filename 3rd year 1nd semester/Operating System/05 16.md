## 9.1 가상 메모리

## 9.2.2 요구 페이지의 성능
- Page Fault 비율 = 페이지 부재율
- 페이지 부재율 0 < p <= 1.0
  - if p = 0 -> 페이지 부재 없음
  - if p = 1 -> 매 번 참조 페이지 오류
- 실제 접근 시간 (EAT; Effective Access Time)
  - (1-p) * 메모리 접근 시간 + p*(페이지 부재 시간)

> 페이지 부재 시의 트랩 : 특정한 페이지 폴트에 대한 알림. 인터럽트와 유사

## 9.3 프로세스 생성
- Copy-on-Write
  - 부모와 자식 프로세스가 처음 생성시에는 같은 페이지를 공유하지만, 한 프로세스가 페이지가 수정할 때 페이지를 공유하는 다른 프로세스도 페이지를 복사하는 것을 의미.
### 페이지 부재 오류 (Page Fault)

## 9.4 페이지 교체
### 페이지 교체 알고리즘
- 디스크에서 요구되는 페이지를 위치 검색
- 비어 있는 프레임 검색
  - 만약 빈 페이지가 있다면 그 프레임 사용
  - 그렇지 않다면 페이지 교체 알고리즘으로 희생자 페이지 선택
  - 희생자 페이지를 디스크에 출력하고, 페이지 테이블에 기록
- 빈 프레임에 요구된 페이지를 불러들이고, 페이지와 프레임 테이블의 내용을 수정
- 사용자 프로세스를 다시 시작

### 참조열(Reference String)
- 페이지 부재 수를 계산하는 데 사용되는 기억장치 참조 순서
  
> 시험 문제 : 참조열을 제시하고, 해당하는 프레임 수를 주고 거게서 Page Fault가 몇 번 발생할지 계산할 수 있어야 함.

### 가상 메모리의 성능
- 가상 메모리 시스템의 목적
  - 페이지 부재 오류율의 최소화
- 페이지 오류율
  - 페이지 부재 오류의 수 / 참조열의 길이
  - 참조열 내의 서로 다른 페이지 수 / 

### 9.4.2 FIFO 교체 알고리즘
- 가장 간단한 페이지 교체 알고리즘
  - 각 페이지에 기억 장치 안으로 들어온 시간을 연관
  - 가장 오래된 페이지가 교체되도록 선택
  - FIFO 큐 이용
- 이해하기 쉽고 프로그램하기도 쉽다.

> 프레임이 늘어나도 Page Fault가 늘어날 수 있다!
> 제일 처음 들어가는 것도 횟수에 포함시킴.

### 9.4.3 최적 교체 알고리즘
- IBM의 Belady에 의해 제시된 B0알고리즘
- 앞으로 가장 오래 사용되지 않을 페이지 교체
  - 모든 알고리리즘 중에서 페이지 오류율이 가장 낮다.
- 구현 불가능

### 9.4.4  LRU(Least Recently Used)교체 알고리즘
- 최적 교체 알고리즘의 근사값
  - 가장 오랫동안 사용하지 않은 페이지 교체
  - 가까운 미래의 근사값으로 가장 최근의 과거를 사용
  - 최적 알고리즘과의 대칭성 때문에 성능이 유사
- LRU의 구현 방법
  - 최후의 사용 시간에 의해 정의되는 페이지 순서를 계수기(counter) 또는 스택으로 관리
> 미래는 예측하기 힘들지만 과거의 기록을 통해 미래를 추측하는 것은 가능.

- 계수기의 사용
  - 각 페이지 테이블 항목과 사용 시간 레지스터를 연관시키고, CPU에 논리 시계나 계수기 추가
  - 가장 작은 시간값을 갖는 페이지를 교체
- 스택의 사용
  - 페이지 번호의 스택을 유지
  - 오버헤드를 발생시키기나 마이크로 코드로 구현 용이
- 두 방법 모두 하드웨어의 지원 필요

### 9.4.5 LUE 근접 알고리즘
- 참조 비트를 이용한 알고리즘
  - 8비트의 참조 영역을 유지하고, 요소가 들어올 때 마다 비트를 하나씩 오른쪽으로 미룸(이전에 있던 값들의 크기가 점점 작아짐.)
  - 가장 낮은 번호를 가진 페이지 교체
  ### SWAP
  - 스왑 공간은 디렉토리 구조 등이 없어서 데이터를 찾아가는데 더 적은 속도가 걸림.

- 2차 기회 페이지 교체 알고리즘
  - 각 페이지에 대해 1비트만 참조용으로 사용
  - 요소를 집어넣을 때 참조 비트 검색
    - 참조 비트가 0이라면 데이터 삽입
    - 참조 비트가 1이라면 참조 비트를 0으로 바꾸고 다음 요소의 참조 번호 검색

### 2차 기회 페이지 교체 알고리즘
- 참조 바이트에 따른 여러 개의 페이지 큐 관리
- 참조 비트와 오염(또는 Modify) 비트로 관리.

### 기타 알고리즘
- LIFO
- LFU (least frequently used) 페이지 교체 알고리즘
  - 각 페이지마다 참조 횟수에 대한 카운터를 두어 가장 작은 수를 가진 페이지 교체
  - 초기에 많이 참조되고 이후 사용되지 않는 페이지는 카운팅이 높은데 오랫동안 교체되지 않는 문제가 있음.
- MFU (most frequently used) 페이지 교체 알고리즘
  - 가장 작은 수의 페이지가 방금 들어온 페이지이므로 조금 더 사용될 것이라는 생각에 근거.
- 사전 교체
- 사전 적재

## 9.5 프레임 할당
- 일정한 사용 가능 메모리를 여러 프로세스에게 어떻게 할당할 것인가?

### 9.5.1 최소 프레임 수
- 명령어 집합의 구조에 의해 정의
- 컴퓨터 구조에 의해 정의

### 9.5.2 할당 알고리즘
- 고정 할당
  - 균등 할당
    - 모든 프로세스에 똑같으 m/n 개의 프레임을 할당
  - 비례 할당
    - 프로세스의 크기에 비례하여 각 프로세스에 프레임을 할당
- 우선순위의 고려
  - 우선 순위가 높은 프로세스에 많은 기억 장소를 할당
  
### 전역 vs 지역 할당
- 전역 교체
  - 프로세스는 모든 프레임 집합으로부터 교체 프레임을 선택.
  - 한 프로세스는 다른 프로세스로부터 프레임을 뺴앗을 수 잇음.